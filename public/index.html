<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FanTeam DFS Optimizer — MVP v2</title>
<link rel="stylesheet" href="/styles.css" />
</head>
<body>
<header>
  <h1>FanTeam DFS Optimizer — MVP</h1>
  <div class="subtitle">European-focused • Transparent algorithms • Multi-sport • FanTeam-ready</div>
</header>
<div class="container" id="authSection">
  <div id="loginForm">
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <select id="tier"><option value="free">Free</option><option value="pro">Pro</option><option value="elite">Elite</option></select>
    <button class="btn" id="registerBtn">Register</button>
    <button class="btn" id="loginBtn">Login</button>
  </div>
  <div id="userInfo" style="display:none;">Logged in as <span id="userDisplay"></span> (<span id="tierDisplay"></span>)</div>
</div>


<div class="container">
  <!-- Progress -->
  <div class="progress-header">
    <div class="progress-steps">
      <div class="progress-step active" id="ps1"><div class="step-number active" id="sn1">1</div><span>Upload</span></div>
      <div class="progress-step" id="ps2"><div class="step-number" id="sn2">2</div><span>Confirm</span></div>
      <div class="progress-step" id="ps3"><div class="step-number" id="sn3">3</div><span>Contest</span></div>
      <div class="progress-step" id="ps4"><div class="step-number" id="sn4">4</div><span>Optimize</span></div>
    </div>
    <button class="btn small" id="resetFlow" type="button">↺ Back to start</button>
  </div>

  <!-- Step 1: Upload -->
  <section class="step active" id="step1">
    <h2>Upload your FanTeam export (CSV)</h2>
    <p class="helper">We’ll auto-detect sport & format. Supports NFL, Football, Golf, F1. The tool applies our validated NFL projection conversion methodology when projections are supplied (placeholder in this MVP).</p>
    <div class="upload-zone" id="uploadZone">
      <div class="upload-icon">📊</div>
      <div class="upload-text">Drop CSV here or click to browse</div>
      <input type="file" id="fileInput" accept=".csv" hidden />
    </div>
    <div class="badge">Free demo mode available — no account required</div>
    <div style="margin-top:12px" class="btn-group">
      <button class="btn" id="demoBtn">Try Demo Data (Cycle sports)</button>
    </div>
  </section>

  <!-- Step 2: Confirm -->
  <section class="step" id="step2">
    <h2>Confirm detection</h2>
    <div class="detection-result">
      <div class="detection-grid">
        <div class="label">Tournament</div><div class="value" id="metaTournament">—</div>
        <div class="label">Event</div><div class="value" id="metaEvent">—</div>
        <div class="label">Detected sport</div><div class="value" id="detectedSport">—</div>
        <div class="label">Contest type</div><div class="value" id="detectedContest">—</div>
        <div class="label">Players found</div><div class="value" id="playerCount">0</div>
        <div class="label">Salary range</div><div class="value" id="salaryRange">—</div>
        <div class="label">Positions</div><div class="value" id="commonPositions">—</div>
      </div>
    </div>

    <label for="sportSelector">Override sport (if needed)</label>
    <select id="sportSelector" class="sport-selector">
      <option value="nfl">🏈 NFL</option>
      <option value="football">⚽ Football/Soccer</option>
      <option value="golf">🏌️ Golf</option>
      <option value="f1">🏎️ Formula 1</option>
    </select>

    <div class="btn-group" style="margin-top:10px">
      <button class="btn" id="backToUpload">← Back</button>
      <button class="btn primary" id="confirmSport">Continue →</button>
    </div>
  </section>

  <!-- Step 3: Contest -->
  <section class="step" id="step3">
    <h2>Select contest format</h2>
    <div class="contest-type">
      <div class="contest-option selected" data-type="full-slate" id="optFull"><strong>Full slate</strong><br><small class="mono">Classic multi-game</small></div>
      <div class="contest-option" data-type="showdown" id="optShow"><strong>Showdown</strong><br><small class="mono">Single game, captain</small></div>
    </div>
    <div class="btn-group">
      <button class="btn" id="backToSport">← Back</button>
      <button class="btn primary" id="confirmContest">Start optimizing →</button>
    </div>
  </section>
</div>

<!-- Step 4: Main interface -->
<section class="main-interface" id="main">
  <aside class="panel">
    <h3>🎯 Contest setup</h3>
    <div class="stat-grid" style="margin-bottom:10px">
      <div class="stat"><div class="v" id="statSport">—</div><div class="k">Sport</div></div>
      <div class="stat"><div class="v" id="statContest">—</div><div class="k">Contest</div></div>
      <div class="stat"><div class="v" id="statPlayers">0</div><div class="k">Players</div></div>
    </div>

    <h3>⚙️ Lineup settings</h3>
    <div class="control-row">
      <div>
        <label for="lineupCount">Lineups</label>
        <input id="lineupCount" type="number" min="1" max="150" value="20" />
      </div>
      <div>
        <label for="strategy">Strategy</label>
        <select id="strategy">
          <option value="balanced">Balanced</option>
          <option value="safe">Safe</option>
          <option value="aggressive">Aggressive</option>
          <option value="contrarian">Contrarian</option>
        </select>
      </div>
    </div>
    <div class="control-row">
      <div>
        <label for="minSalary">Min salary</label>
        <input id="minSalary" type="number" />
      </div>
      <div>
        <label for="maxSalary">Max salary</label>
        <input id="maxSalary" type="number" />
      </div>
    </div>
    <button class="btn primary" id="generateBtn" style="width:100%;margin-top:10px">🚀 Generate lineups</button>

    <hr class="sep" />
    <h3>🔍 Transparency</h3>
    <div class="stat">
      <div class="k">Constraints applied</div>
      <div class="helper" id="constraintsText">—</div>
    </div>

    <h3 style="margin-top:10px">📊 Validation</h3>
    <div class="stat-grid">
      <div class="stat"><div class="v" id="selectedCount">0</div><div class="k">Selected</div></div>
      <div class="stat"><div class="v" id="captainCount">0</div><div class="k">Captains</div></div>
      <div class="stat"><div class="v" id="lineupResults">0</div><div class="k">Generated</div></div>
    </div>
  </aside>

  <main class="panel">
    <div class="searchbar">
      <h3 style="margin:0;flex:1">👥 Player management</h3>
      <input id="searchPlayers" type="text" placeholder="Search by name..." style="max-width:180px" />
      <select id="positionFilter" style="max-width:120px"><option value="">All positions</option></select>
      <select id="teamFilter" style="max-width:120px"><option value="">All teams</option></select>
    </div>
    <div class="btn-group" style="margin-bottom:8px">
      <button class="btn" id="selectAll">Select all</button>
      <button class="btn" id="selectNone">Clear all</button>
      <button class="btn" id="selectExpected">Expected only</button>
      <button class="btn" id="captainAll">Captain all</button>
      <button class="btn" id="importProj">Import projections</button>
      <button class="btn" id="loadDemo">Load demo data</button>
    </div>
    <input type="file" id="projInput" accept=".csv" hidden />

    <div class="scroller">
      <table class="table">
        <thead>
          <tr>
            <th>✓</th>
            <th>C</th>
            <th>Player</th>
            <th>Pos</th>
            <th>Team</th>
            <th id="thProj" class="sortable">Proj</th>
            <th id="thSalary" class="sortable">Salary</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="playerTableBody"></tbody>
      </table>
    </div>

    <h3 style="margin-top:16px">🏆 Generated lineups</h3>
    <div class="scroller" style="max-height:320px">
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Captain</th>
            <th>Players</th>
            <th>Total salary</th>
          </tr>
        </thead>
        <tbody id="lineupTableBody"></tbody>
      </table>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <a class="btn primary" id="downloadBtn" href="#" download="fanteam_lineups.csv" disabled>📥 Download CSV</a>
      <button class="btn" id="clearResults">Clear results</button>
      <button class="btn" id="startOver">← Start over</button>
    </div>
  </main>
</section>

<div id="toastContainer"></div>

<script type="module" src="src/main.js"></script>
<script type="module" src="/auth.js"></script>
</body>
</html>
