<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8" /&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</p>
<p class="p1">&lt;title&gt;FanTeam DFS Optimizer â€” MVP v2&lt;/title&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1">:root{--bg:#0b0e13;--panel:#121723;--mut:#8aa0c9;--text:#e8ecf6;--accent:#2fe089;--warn:#ffb86c;--err:#ff6b6b;--success:#2fe089;--br:14px}</p>
<p class="p1">*{box-sizing:border-box}</p>
<p class="p1">body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto;overflow-x:hidden}</p>
<p class="p1">header{padding:20px;text-align:center;border-bottom:1px solid #1b2131;background:linear-gradient(180deg,#121723,#0b0e13)}</p>
<p class="p1">h1{margin:0;font-size:24px;color:var(--accent);font-weight:600}</p>
<p class="p1">.subtitle{color:var(--mut);margin-top:8px;font-size:14px}</p>
<p class="p1">.container{max-width:960px;margin:0 auto;padding:40px 20px}</p>
<p class="p1">small.mono{font-family:ui-monospace,Menlo,Consolas,monospace;color:#9fb2dc}</p>
<p class="p1">.progress-steps{display:flex;justify-content:center;gap:20px;margin:20px 0}</p>
<p class="p1">.progress-step{display:flex;align-items:center;gap:8px;color:var(--mut);font-size:12px}</p>
<p class="p1">.progress-step.active{color:var(--accent)}</p>
<p class="p1">.progress-step.completed{color:var(--success)}</p>
<p class="p1">.step-number{width:24px;height:24px;border-radius:50%;background:#1a2438;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600}</p>
<p class="p1">.step-number.active{background:var(--accent);color:#0b291a}</p>
<p class="p1">.step-number.completed{background:var(--success);color:#0b291a}</p>
<p class="p1">.step{display:none;text-align:left}</p>
<p class="p1">.step.active{display:block}</p>
<p class="p1">.step h2{color:var(--accent);margin-bottom:12px;font-size:20px}</p>
<p class="p1">.step p{color:var(--mut);margin-bottom:16px;line-height:1.6}</p>
<p class="p1">.upload-zone{border:2px dashed #344155;border-radius:12px;padding:40px 24px;margin:16px 0;cursor:pointer;transition:all .2s;background:rgba(26,36,56,.25)}</p>
<p class="p1">.upload-zone:hover,.upload-zone.dragover{border-color:var(--accent);background:rgba(47,224,137,.08)}</p>
<p class="p1">.upload-zone.has-file{border-color:var(--success);background:rgba(47,224,137,.1)}</p>
<p class="p1">.upload-icon{font-size:40px;margin-bottom:10px;color:var(--accent);text-align:center}</p>
<p class="p1">.upload-text{text-align:center}</p>
<p class="p1">.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid #24314d;background:#10182a;color:#e8ecf6;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:14px;transition:all .15s;text-decoration:none;font-weight:600}</p>
<p class="p1">.btn:hover{background:#1a2438;border-color:#2fe089}</p>
<p class="p1">.btn.primary{background:linear-gradient(135deg,#2fe089,#1db26a);color:#072615;border-color:#1d8a55}</p>
<p class="p1">.btn.primary:hover{filter:brightness(1.05)}</p>
<p class="p1">.btn:disabled{opacity:.5;cursor:not-allowed}</p>
<p class="p1">.btn-group{display:flex;gap:10px;flex-wrap:wrap}</p>
<p class="p1">.detection-result{background:var(--panel);border:1px solid #1b2131;border-radius:8px;padding:12px;margin:12px 0}</p>
<p class="p1">.detection-grid{display:grid;grid-template-columns:1fr 2fr;gap:8px;align-items:center}</p>
<p class="p1">.label{color:#9db1d9;font-size:12px}</p>
<p class="p1">.value{color:#e8ecf6;font-weight:600;font-size:13px}</p>
<p class="p1">.sport-selector{background:#0d1220;border:1px solid #20283a;border-radius:8px;padding:12px;color:var(--text);font-size:14px;width:100%;margin:10px 0}</p>
<p class="p1">.contest-type{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0}</p>
<p class="p1">.contest-option{background:var(--panel);border:2px solid #1b2131;border-radius:10px;padding:16px;cursor:pointer;transition:all .15s}</p>
<p class="p1">.contest-option:hover{border-color:var(--accent)}</p>
<p class="p1">.contest-option.selected{border-color:var(--success);background:rgba(47,224,137,.08)}</p>
<p class="p1">.main-interface{display:none;max-width:1400px;margin:0 auto;padding:20px}</p>
<p class="p1">.main-interface.active{display:grid;grid-template-columns:360px 1fr;gap:16px}</p>
<p class="p1">@media(max-width:1100px){.main-interface.active{grid-template-columns:1fr}}</p>
<p class="p1">.panel{background:var(--panel);border:1px solid #1b2131;border-radius:var(--br);padding:14px;box-shadow:0 8px 30px rgba(0,0,0,.25)}</p>
<p class="p1">.panel h3{margin:0 0 10px 0;font-size:15px;color:var(--accent)}</p>
<p class="p1">.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:8px}</p>
<p class="p1">.stat{background:#0d1220;border:1px solid #1e2740;border-radius:8px;padding:8px}</p>
<p class="p1">.stat .v{font-weight:700;color:var(--accent)}</p>
<p class="p1">.stat .k{font-size:11px;color:#9fb0d7}</p>
<p class="p1">.control-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}</p>
<p class="p1">input[type="number"],input[type="text"],select{background:#0d1220;color:var(--text);border:1px solid #20283a;border-radius:8px;padding:8px;font-size:13px;width:100%}</p>
<p class="p1">label{display:block;margin:6px 0 4px;color:#aab2cd;font-size:12px}</p>
<p class="p1">.scroller{max-height:420px;overflow:auto;border:1px solid #1e2740;border-radius:8px;background:#0a0f1a}</p>
<p class="p1">.table{width:100%;border-collapse:collapse;font-size:12px}</p>
<p class="p1">.table th,.table td{padding:6px 8px;border-bottom:1px solid #20283a;text-align:left}</p>
<p class="p1">.table th{position:sticky;top:0;background:#0f1524;z-index:1;color:#c8d2ef;font-weight:600;font-size:11px}</p>
<p class="p1">.row-expected{background:rgba(47,224,137,.06);border-left:3px solid var(--success)}</p>
<p class="p1">.row-possible{background:rgba(255,184,108,.06);border-left:3px solid var(--warn)}</p>
<p class="p1">.row-unexpected{background:rgba(255,107,107,.06);border-left:3px solid var(--err)}</p>
<p class="p1">.searchbar{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}</p>
<p class="p1">.toast{position:fixed;top:16px;right:16px;background:var(--panel);border:1px solid #1b2131;padding:12px 14px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.3);z-index:1000;max-width:320px}</p>
<p class="p1">.toast.success{border-color:var(--success);background:rgba(47,224,137,.08)}</p>
<p class="p1">.toast.error{border-color:var(--err);background:rgba(255,107,107,.08)}</p>
<p class="p1">.helper{font-size:12px;color:#aab2cd}</p>
<p class="p1">.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid #2a3552;background:#0f1726;border-radius:999px;padding:4px 8px;font-size:11px;color:#c9d5f5}</p>
<p class="p1">hr.sep{border:none;border-top:1px solid #1b2131;margin:12px 0}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;h1&gt;FanTeam DFS Optimizer â€” MVP&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="subtitle"&gt;European-focused â€¢ Transparent algorithms â€¢ Multi-sport â€¢ FanTeam-ready&lt;/div&gt;</p>
<p class="p1">&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="progress-steps"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="progress-step" id="ps1"&gt;&lt;div class="step-number" id="sn1"&gt;1&lt;/div&gt;&lt;span&gt;Upload&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="progress-step" id="ps2"&gt;&lt;div class="step-number" id="sn2"&gt;2&lt;/div&gt;&lt;span&gt;Confirm&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="progress-step" id="ps3"&gt;&lt;div class="step-number" id="sn3"&gt;3&lt;/div&gt;&lt;span&gt;Contest&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="progress-step" id="ps4"&gt;&lt;div class="step-number" id="sn4"&gt;4&lt;/div&gt;&lt;span&gt;Optimize&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Step 1 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;section class="step" id="step1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h2&gt;Upload your FanTeam export (CSV)&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;p class="helper"&gt;Weâ€™ll auto-detect sport &amp; format. Supports NFL, Football, Golf, F1. NFL projection conversion methodology is validated (placeholder here until projections are added).&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="upload-zone" id="uploadZone"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="upload-icon"&gt;ğŸ“Š&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="upload-text"&gt;Drop CSV here or click to browse&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;input type="file" id="fileInput" accept=".csv" hidden /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="badge"&gt;Free demo mode available â€” no account required&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div style="margin-top:12px" class="btn-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="demoBtn"&gt;Try Demo Data (Cycle sports)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Step 2 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;section class="step" id="step2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h2&gt;Confirm detection&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="detection-result"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="detection-grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Tournament&lt;/div&gt;&lt;div class="value" id="metaTournament"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Event&lt;/div&gt;&lt;div class="value" id="metaEvent"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Detected sport&lt;/div&gt;&lt;div class="value" id="detectedSport"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Contest type&lt;/div&gt;&lt;div class="value" id="detectedContest"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Players found&lt;/div&gt;&lt;div class="value" id="playerCount"&gt;0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Salary range&lt;/div&gt;&lt;div class="value" id="salaryRange"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="label"&gt;Positions&lt;/div&gt;&lt;div class="value" id="commonPositions"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;label for="sportSelector"&gt;Override sport (if needed)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;select id="sportSelector" class="sport-selector"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="nfl"&gt;ğŸˆ NFL&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="football"&gt;âš½ Football/Soccer&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="golf"&gt;ğŸŒï¸ Golf&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;option value="f1"&gt;ğŸï¸ Formula 1&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/select&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="btn-group" style="margin-top:10px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="backToUpload"&gt;â† Back&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn primary" id="confirmSport"&gt;Continue â†’&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Step 3 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;section class="step" id="step3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h2&gt;Select contest format&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="contest-type"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="contest-option selected" data-type="full-slate" id="optFull"&gt;&lt;strong&gt;Full slate&lt;/strong&gt;&lt;br&gt;&lt;small class="mono"&gt;Classic multi-game&lt;/small&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="contest-option" data-type="showdown" id="optShow"&gt;&lt;strong&gt;Showdown&lt;/strong&gt;&lt;br&gt;&lt;small class="mono"&gt;Single game, captain&lt;/small&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="btn-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="backToSport"&gt;â† Back&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn primary" id="confirmContest"&gt;Start optimizing â†’&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/section&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;!-- Step 4 --&gt;</p>
<p class="p1">&lt;section class="main-interface" id="main"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;aside class="panel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3&gt;ğŸ¯ Contest setup&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="stat-grid" style="margin-bottom:10px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stat"&gt;&lt;div class="v" id="statSport"&gt;â€”&lt;/div&gt;&lt;div class="k"&gt;Sport&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stat"&gt;&lt;div class="v" id="statContest"&gt;â€”&lt;/div&gt;&lt;div class="k"&gt;Contest&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stat"&gt;&lt;div class="v" id="statPlayers"&gt;0&lt;/div&gt;&lt;div class="k"&gt;Players&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3&gt;âš™ï¸ Lineup settings&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="control-row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label for="lineupCount"&gt;Lineups&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="lineupCount" type="number" min="1" max="150" value="20" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label for="strategy"&gt;Strategy&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;select id="strategy"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option value="balanced"&gt;Balanced&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option value="safe"&gt;Safe&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option value="aggressive"&gt;Aggressive&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;option value="contrarian"&gt;Contrarian&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="control-row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label for="minSalary"&gt;Min salary&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="minSalary" type="number" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label for="maxSalary"&gt;Max salary&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="maxSalary" type="number" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;button class="btn primary" id="generateBtn" style="width:100%;margin-top:10px"&gt;ğŸš€ Generate lineups&lt;/button&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;hr class="sep" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3&gt;ğŸ” Transparency&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="stat"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="k"&gt;Constraints applied&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="helper" id="constraintsText"&gt;â€”&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3 style="margin-top:10px"&gt;ğŸ“Š Validation&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="stat-grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stat"&gt;&lt;div class="v" id="selectedCount"&gt;0&lt;/div&gt;&lt;div class="k"&gt;Selected&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stat"&gt;&lt;div class="v" id="captainCount"&gt;0&lt;/div&gt;&lt;div class="k"&gt;Captains&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stat"&gt;&lt;div class="v" id="lineupResults"&gt;0&lt;/div&gt;&lt;div class="k"&gt;Generated&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/aside&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;main class="panel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="searchbar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h3 style="margin:0;flex:1"&gt;ğŸ‘¥ Player management&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;input id="searchPlayers" type="text" placeholder="Search by name..." style="max-width:180px" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;select id="positionFilter" style="max-width:120px"&gt;&lt;option value=""&gt;All positions&lt;/option&gt;&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="btn-group" style="margin-bottom:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="selectAll"&gt;Select all&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="selectNone"&gt;Clear all&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="selectExpected"&gt;Expected only&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="captainAll"&gt;Captain all&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="scroller"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;table class="table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;âœ“&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;C&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Player&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Pos&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Team&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Salary&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Status&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;tbody id="playerTableBody"&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3 style="margin-top:16px"&gt;ğŸ† Generated lineups&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="scroller" style="max-height:320px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;table class="table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;#&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Captain&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Players&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;th&gt;Total salary&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;tbody id="lineupTableBody"&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;a class="btn primary" id="downloadBtn" href="#" download="fanteam_lineups.csv" disabled&gt;ğŸ“¥ Download CSV&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="clearResults"&gt;Clear results&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="startOver"&gt;â† Start over&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/main&gt;</p>
<p class="p1">&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div id="toastContainer"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">// ---------- DEMO CSVs ----------</p>
<p class="p1">const DEMO_CSVS = {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>nfl_full: { label:'NFL â€” Full slate', sport:'nfl', contest:'full-slate', tournament:'Tournament 1009899 (846 players)', eventName:'NFL Week 1 Full Slate', url:'./demo/1009899_players_20250908161603.csv' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>nfl_show: { label:'NFL â€” Showdown', sport:'nfl', contest:'showdown', tournament:'Tournament 1010808 (52 players)', eventName:'NFL Showdown (Single Game)', url:'./demo/1010808_players_20250908161619.csv' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>fb_full:<span class="Apple-converted-space">Â  </span>{ label:'Football â€” CL full slate', sport:'football', contest:'full-slate', tournament:'Tournament 1008839 (414 players)', eventName:'Champions League Night', url:'./demo/1008839_players_20250906222543.csv' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>fb_show:<span class="Apple-converted-space">Â  </span>{ label:'Football â€” Showdown', sport:'football', contest:'showdown', tournament:'Tournament 1008665 (30 players)', eventName:'Real Madrid vs Manchester City', url:'./demo/1008665_players_20250906172857.csv' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>f1_full:<span class="Apple-converted-space">Â  </span>{ label:'F1 â€” Race weekend', sport:'f1', contest:'full-slate', tournament:'Tournament 1009037 (34 players)', eventName:'F1 Race Weekend', url:'./demo/1009037_players_20250908102649.csv' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>golf_full:{ label:'Golf â€” PGA tournament', sport:'golf', contest:'full-slate', tournament:'Tournament 1002987 (69 players)', eventName:'PGA Tournament', url:'./demo/1000000_players_20250815093906.csv' }</p>
<p class="p1">};</p>
<p class="p1">const DEMO_ROTATION = ['nfl_full','nfl_show','fb_full','fb_show','f1_full','golf_full'];</p>
<p class="p1">let demoIndex = -1;</p>
<p class="p2"><br></p>
<p class="p1">// ---------- sport configs ----------</p>
<p class="p1">const SPORT_CONFIGS = {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>nfl:{ name:'NFL', icon:'ğŸˆ', lineupSize:9, positions:['QUARTERBACK','RUNNING_BACK','WIDE_RECEIVER','TIGHT_END','DST'], salaryRange:[49500,50000], currency:'$', fullSlateSize:846, showdownSize:52 },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>football:{ name:'Football/Soccer', icon:'âš½', lineupSize:6, positions:['GOALKEEPER','DEFENDER','MIDFIELDER','FORWARD'], salaryRange:[98,100], currency:'Â£', fullSlateSize:414, showdownSize:30 },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>golf:{ name:'Golf', icon:'ğŸŒï¸', lineupSize:6, positions:['PLAYER'], salaryRange:[98,100], currency:'$', fullSlateSize:69, showdownSize:69 },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>f1:{ name:'Formula 1', icon:'ğŸï¸', lineupSize:6, positions:['DRIVER','CONSTRUCTOR'], salaryRange:[98,102], currency:'Â£', fullSlateSize:34, showdownSize:34 }</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">const state = { currentStep:1, players:[], lineups:[], detectedSport:'nfl', contestType:'full-slate', currentDemoSport:'nfl', datasetMeta:{ tournament:'', eventName:'' } };</p>
<p class="p2"><br></p>
<p class="p1">// ---------- utils ----------</p>
<p class="p1">const esc = (s='') =&gt; s.replace(/[&amp;&lt;&gt;"']/g, c=&gt;({ '&amp;':'&amp;amp;','&lt;':'&amp;lt;','&gt;':'&amp;gt;','"':'&amp;quot;','\'':'&amp;#39;' }[c]));</p>
<p class="p1">const toNumber = v =&gt; { if(typeof v!== 'string') return +v||0; const cleaned = v.replace(/[^0-9.\-]/g,''); return parseFloat(cleaned)||0; };</p>
<p class="p1">const norm = s =&gt; (s||'').toLowerCase().replace(/[_\s]/g,'');</p>
<p class="p2"><br></p>
<p class="p1">function showToast(msg,type='success'){ const t=document.createElement('div'); t.className=`toast ${type}`; t.textContent=msg; document.body.appendChild(t); setTimeout(()=&gt;t.remove(),3000); }</p>
<p class="p2"><br></p>
<p class="p1">function parseCSV(text){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const lines = text.split(/\r?\n/).filter(l=&gt;l.trim().length);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rows=[]; for(const line of lines){ let cur=''; let inQ=false; const out=[]; for(let i=0;i&lt;line.length;i++){ const ch=line[i], nx=line[i+1]; if(ch==='"'){ if(inQ &amp;&amp; nx==='"'){ cur+='"'; i++; } else { inQ=!inQ; } } else if(ch===',' &amp;&amp; !inQ){ out.push(cur.trim()); cur=''; } else { cur+=ch; } } out.push(cur.trim()); rows.push(out); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return rows;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function usesCaptains(sport, contest){ if(sport==='nfl') return contest==='showdown'; if(sport==='football') return true; if(sport==='golf') return true; if(sport==='f1') return true; return false; }</p>
<p class="p2"><br></p>
<p class="p1">function detectSportFromCSV(players){ if(!players||!players.length) return 'nfl';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const positions = [...new Set(players.map(p=&gt;norm(p.position)))];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const avgSalary = players.reduce((s,p)=&gt;s+(p.salary||0),0)/players.length;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const n = players.length;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const nfl = ['quarterback','runningback','widereceiver','tightend','dst','defense','qb','rb','wr','te'];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(positions.some(p=&gt;nfl.includes(p))){ state.contestType = n&gt;100? 'full-slate':'showdown'; return 'nfl'; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const foot = ['defender','midfielder','forward','goalkeeper','gk','def','mid','fwd'];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(positions.some(p=&gt;foot.includes(p))){ state.contestType = n&gt;100? 'full-slate':'showdown'; return 'football'; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const f1 = ['driver','constructor']; if(positions.some(p=&gt;f1.includes(p)) || (n&gt;=30 &amp;&amp; n&lt;=40)){ state.contestType='full-slate'; return 'f1'; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(n&gt;=60 &amp;&amp; n&lt;=80){ state.contestType='full-slate'; return 'golf'; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(avgSalary&gt;1000){ state.contestType = n&gt;100? 'full-slate':'showdown'; return 'nfl'; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return 'football';</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ---- Robust column helpers (fixes numeric-name issue) ----</p>
<p class="p1">function pickColumns(headers){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const findIdx = arr =&gt; arr.map(k =&gt; headers.findIndex(h =&gt; h.includes(k))).find(i =&gt; i !== -1);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>displayCol: findIdx(['playername','fullname','full_name','player','name_display','name']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lastCol:<span class="Apple-converted-space">Â  Â  </span>findIdx(['surname','lname','last']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>firstCol: <span class="Apple-converted-space">Â  </span>findIdx(['fname','first','forename','given']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>salaryCol:<span class="Apple-converted-space">Â  </span>findIdx(['price','salary','cost','value']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>posCol: <span class="Apple-converted-space">Â  Â  </span>findIdx(['position','pos']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>teamCol:<span class="Apple-converted-space">Â  Â  </span>findIdx(['club','team']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>statusCol:<span class="Apple-converted-space">Â  </span>findIdx(['lineup','status']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>idCol:<span class="Apple-converted-space">Â  Â  Â  </span>findIdx(['playerid','pid','id']),</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>};</p>
<p class="p1">}</p>
<p class="p1">function looksNumericish(s){ return /\d{3,}/.test((s||'').replace(/[,.\s]/g,'')); }</p>
<p class="p1">function buildDisplayName(row, cols){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const d = cols.displayCol!==-1? (row[cols.displayCol]||'').trim() : '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const f = cols.firstCol!==-1? <span class="Apple-converted-space">Â  </span>(row[cols.firstCol]<span class="Apple-converted-space">Â  </span>||'').trim() : '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const l = cols.lastCol!==-1?<span class="Apple-converted-space">Â  Â  </span>(row[cols.lastCol] <span class="Apple-converted-space">Â  </span>||'').trim() : '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let name = d || (f &amp;&amp; l ? `${f} ${l}` : (l || f));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!name || looksNumericish(name)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(f &amp;&amp; !looksNumericish(f)) name = f;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(l &amp;&amp; !looksNumericish(l)) name = name ? `${name} ${l}` : l;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return (name||'').trim();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function importCSV(file){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const text = await file.text();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rows = parseCSV(text);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(rows.length&lt;2) throw new Error('CSV needs header + at least 1 data row');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const headers = rows[0].map(h=&gt;norm(h));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cols = pickColumns(headers);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(cols.salaryCol===-1) throw new Error('Required "Price/Salary" column not found');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(cols.displayCol===-1 &amp;&amp; cols.firstCol===-1 &amp;&amp; cols.lastCol===-1) throw new Error('Name columns not found (need Name/Player or First/Last)');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const posMap = { DEF:'DEFENDER', MID:'MIDFIELDER', FWD:'FORWARD', GK:'GOALKEEPER' };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const players=[];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=1;i&lt;rows.length;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const r = rows[i]; if(!r||!r.length) continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const name = buildDisplayName(r, cols);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!name || looksNumericish(name)) continue;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const salary = toNumber(r[cols.salaryCol]); if(salary&lt;=0) continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const id <span class="Apple-converted-space">Â  </span>= cols.idCol!==-1? <span class="Apple-converted-space">Â  </span>(r[cols.idCol]<span class="Apple-converted-space">Â  </span>||'').trim() : `p_${i}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const team = cols.teamCol!==-1? (r[cols.teamCol]||'').trim() : '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let position = cols.posCol!==-1? (r[cols.posCol]||'').trim().toUpperCase() : '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>position = posMap[position] || position;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let status = 'expected';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(cols.statusCol!==-1){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const sv=(r[cols.statusCol]||'').toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(sv.includes('possible')) status='possible';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>else if(sv.includes('unexpected')||sv.includes('doubt')) status='unexpected';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>players.push({ id, name, first:'', last:'', team, position, salary, status, selected: status==='expected', captain:false });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!players.length) throw new Error('No valid players found');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return players;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Load demo CSV (same parsing)</p>
<p class="p1">async function loadDemoCsv(key){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const preset = DEMO_CSVS[key];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!preset) throw new Error(`Unknown demo key: ${key}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const res = await fetch(preset.url);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!res.ok) throw new Error(`Failed to fetch ${preset.url}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const csvText = await res.text();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rows = parseCSV(csvText);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(rows.length&lt;2) throw new Error(`Demo "${key}" CSV appears empty.`);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const headers = rows[0].map(h=&gt;norm(h));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cols = pickColumns(headers);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(cols.salaryCol===-1) throw new Error('Demo missing required columns (Price/Salary).');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const posMap = { DEF:'DEFENDER', MID:'MIDFIELDER', FWD:'FORWARD', GK:'GOALKEEPER' };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const players=[];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=1;i&lt;rows.length;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const r = rows[i]; if(!r||!r.length) continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const name = buildDisplayName(r, cols);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!name || looksNumericish(name)) continue;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const salary = toNumber(r[cols.salaryCol]); if(salary&lt;=0) continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const id <span class="Apple-converted-space">Â  </span>= cols.idCol!==-1? <span class="Apple-converted-space">Â  </span>(r[cols.idCol]<span class="Apple-converted-space">Â  </span>||'').trim() : `p_${i}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const team = cols.teamCol!==-1? (r[cols.teamCol]||'').trim() : '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let position = cols.posCol!==-1? (r[cols.posCol]||'').trim().toUpperCase() : '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>position = posMap[position] || position;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let status = 'expected';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(cols.statusCol!==-1){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const sv=(r[cols.statusCol]||'').toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(sv.includes('possible')) status='possible';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>else if(sv.includes('unexpected')||sv.includes('doubt')) status='unexpected';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>players.push({ id, name, first:'', last:'', team, position, salary, status, selected: status==='expected', captain:false });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return { players, sport: preset.sport, contest: preset.contest, tournament: preset.tournament, eventName: preset.eventName, label: preset.label };</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function demoKeyFor(sport, contest){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const entry = Object.entries(DEMO_CSVS).find(([,p]) =&gt; p.sport===sport &amp;&amp; p.contest===contest)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>|| Object.entries(DEMO_CSVS).find(([,p]) =&gt; p.sport===sport);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return entry ? entry[0] : null;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ---------- UI state / rendering ----------</p>
<p class="p1">function setStep(k){ [1,2,3,4].forEach(i=&gt;{ const s=document.getElementById(`step${i}`); const ps=document.getElementById(`ps${i}`); const sn=document.getElementById(`sn${i}`); if(s) s.classList.toggle('active', i===k &amp;&amp; i&lt;=3); if(ps&amp;&amp;sn){ ps.classList.remove('active','completed'); sn.classList.remove('active','completed'); if(i&lt;k){ ps.classList.add('completed'); sn.classList.add('completed'); } else if(i===k){ ps.classList.add('active'); sn.classList.add('active'); } } });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.getElementById('main').classList.toggle('active', k===4); state.currentStep=k; refreshCaptainButtons(); }</p>
<p class="p2"><br></p>
<p class="p1">function updateDetection(){ const cfg = SPORT_CONFIGS[state.detectedSport]; const n = state.players.length; document.getElementById('playerCount').textContent=n; document.getElementById('detectedSport').textContent=cfg.name; document.getElementById('detectedContest').textContent = state.contestType==='showdown' ? 'Showdown' : 'Full slate'; document.getElementById('sportSelector').value = state.detectedSport; document.getElementById('metaTournament').textContent = state.datasetMeta.tournament||'â€”'; document.getElementById('metaEvent').textContent = state.datasetMeta.eventName||'â€”';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(n){ const salaries = state.players.map(p=&gt;p.salary).filter(s=&gt;s&gt;0); const min=Math.min(...salaries), max=Math.max(...salaries); document.getElementById('salaryRange').textContent = `${cfg.currency}${Math.round(min)} - ${cfg.currency}${Math.round(max)}`; const positions=[...new Set(state.players.map(p=&gt;p.position).filter(Boolean))]; document.getElementById('commonPositions').textContent = positions.slice(0,6).join(', ');} else { document.getElementById('salaryRange').textContent= `${cfg.currency}0 - ${cfg.currency}0`; document.getElementById('commonPositions').textContent='â€”'; }</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function updateStats(){ const sel=state.players.filter(p=&gt;p.selected).length; const caps=state.players.filter(p=&gt;p.captain).length; document.getElementById('selectedCount').textContent=sel; document.getElementById('captainCount').textContent=caps; document.getElementById('statPlayers').textContent=state.players.length; }</p>
<p class="p2"><br></p>
<p class="p1">function refreshCaptainButtons(){ const btn=document.getElementById('captainAll'); const use=usesCaptains(state.detectedSport, state.contestType); if(btn){ btn.disabled = !use; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cfg = SPORT_CONFIGS[state.detectedSport]; const min=+document.getElementById('minSalary').value||cfg.salaryRange[0]; const max=+document.getElementById('maxSalary').value||cfg.salaryRange[1]; const ct = use? 'Captain required' : 'No captain'; document.getElementById('constraintsText').textContent = `${cfg.name} â€¢ ${state.contestType} â€¢ Lineup size ${cfg.lineupSize} â€¢ ${ct} â€¢ Salary ${cfg.currency}${min}â€“${cfg.currency}${max}`;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function derivePositionOptions(){ const sel=document.getElementById('positionFilter'); sel.innerHTML = '&lt;option value=""&gt;All positions&lt;/option&gt;'; const uniq=[...new Set(state.players.map(p=&gt;p.position).filter(Boolean))].sort(); uniq.forEach(pos=&gt;{ const o=document.createElement('option'); o.value=pos; o.textContent=pos; sel.appendChild(o); }); }</p>
<p class="p2"><br></p>
<p class="p1">function filteredPlayers(){ const q=document.getElementById('searchPlayers').value.toLowerCase(); const pf=document.getElementById('positionFilter').value; return state.players.filter(p=&gt;{ const s=!q || p.name.toLowerCase().includes(q); const m=!pf || p.position===pf; return s&amp;&amp;m; }); }</p>
<p class="p2"><br></p>
<p class="p1">function renderPlayers(){ const cfg = SPORT_CONFIGS[state.detectedSport]; const body=document.getElementById('playerTableBody'); body.innerHTML = filteredPlayers().map(p=&gt;{ const rowClass = p.status==='expected'? 'row-expected' : (p.status==='possible'? 'row-possible' : 'row-unexpected'); return `&lt;tr class="${rowClass}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;&lt;input type="checkbox" ${p.selected?'checked':''} onchange="toggleSelected('${p.id}')" /&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;&lt;input type="checkbox" ${p.captain?'checked':''} ${!usesCaptains(state.detectedSport, state.contestType)?'disabled':''} onchange="toggleCaptain('${p.id}')" /&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;${esc(p.name)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;${esc(p.position)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;${esc(p.team||'')}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;${cfg.currency}${p.salary}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;td&gt;&lt;span class="helper" style="color:${p.status==='expected'?'#2fe089':p.status==='possible'?'#ffb86c':'#ff6b6b'}"&gt;${p.status}&lt;/span&gt;&lt;/td&gt;</p>
<p class="p1">&lt;/tr&gt;`; }).join(''); }</p>
<p class="p2"><br></p>
<p class="p1">function renderLineups(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cfg=SPORT_CONFIGS[state.detectedSport];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.getElementById('lineupTableBody');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const use=usesCaptains(state.detectedSport, state.contestType);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body.innerHTML = state.lineups.map(l=&gt;`&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;td&gt;${l.id}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;td&gt;${esc(use ? (l.captain?.name||'') : 'â€”')}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;td&gt;${l.players.map(p=&gt;esc(p.name)).join(', ')}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;td&gt;${cfg.currency}${l.totalSalary}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/tr&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.getElementById('lineupResults').textContent = state.lineups.length;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateDownloadLink();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const dl=document.getElementById('downloadBtn');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(state.lineups.length&gt;0) dl.removeAttribute('disabled'); else dl.setAttribute('disabled','');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function updateDownloadLink(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cfg=SPORT_CONFIGS[state.detectedSport];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const use=usesCaptains(state.detectedSport, state.contestType);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const headers = Array.from({length: cfg.lineupSize}, (_,i)=&gt;`Player${i+1}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(use) headers.push('Captain');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rows=[headers];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.lineups.forEach(l=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const names = l.players.map(p=&gt;p.name);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>while(names.length&lt;cfg.lineupSize) names.push('');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(use) names.push(l.captain?.name||'');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>rows.push(names);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const csv = rows.map(r=&gt;r.join(',')).join('\n');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const blob=new Blob([csv],{type:'text/csv'});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.getElementById('downloadBtn').href = URL.createObjectURL(blob);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ---------- Max-spend generator (no projections) ----------</p>
<p class="p1">function generateLineupsMaxSpend(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cfg = SPORT_CONFIGS[state.detectedSport];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const withCap = usesCaptains(state.detectedSport, state.contestType);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const pool = state.players.filter(p =&gt; p.selected).sort((a,b)=&gt;b.salary-a.salary);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(pool.length &lt; cfg.lineupSize) throw new Error(`Need â‰¥ ${cfg.lineupSize} selected players; have ${pool.length}.`);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let caps = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(withCap){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>caps = pool.filter(p=&gt;p.captain);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!caps.length) throw new Error('Need at least 1 captain candidate.');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>caps = [null];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const N <span class="Apple-converted-space">Â  </span>= +document.getElementById('lineupCount').value || 20;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const min = +document.getElementById('minSalary').value <span class="Apple-converted-space">Â  </span>|| cfg.salaryRange[0];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const max = +document.getElementById('maxSalary').value <span class="Apple-converted-space">Â  </span>|| cfg.salaryRange[1];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const uniq = new Set();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const out<span class="Apple-converted-space">Â  </span>= [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tryBuild = (cap) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const base=[]; let total=0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(cap){ base.push(cap); total+=cap.salary; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const others = pool.filter(p=&gt;!cap || p.id!==cap.id);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Greedy fill with most expensive</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(const p of others){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(base.length&gt;=cfg.lineupSize) break;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(total + p.salary &lt;= max){ base.push(p); total += p.salary; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// If still short, overfill then trim/adjust</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(base.length&lt;cfg.lineupSize){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for(const p of others){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(base.find(x=&gt;x.id===p.id)) continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>base.push(p); total += p.salary;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(base.length&gt;=cfg.lineupSize) break;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Trim to size and adjust under cap</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>base.sort((a,b)=&gt;b.salary-a.salary);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>while(base.length&gt;cfg.lineupSize){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cheapestIdx = base.reduce((m,p,i)=&gt; p.salary&lt;base[m].salary? i:m, 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>total -= base[cheapestIdx].salary;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>base.splice(cheapestIdx,1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Improve spend by swapping cheapest up where possible</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let improved=true, guard=0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>while(improved &amp;&amp; guard&lt;200){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>improved=false; guard++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cheapestIdx = base.reduce((m,p,i)=&gt; p.salary&lt;base[m].salary? i:m, 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cheapest = base[cheapestIdx];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const candidate = others.find(p =&gt; !base.find(x=&gt;x.id===p.id) &amp;&amp; (total - cheapest.salary + p.salary) &lt;= max &amp;&amp; p.salary &gt; cheapest.salary);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(candidate){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>total = total - cheapest.salary + candidate.salary;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>base[cheapestIdx] = candidate;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>improved = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(base.length===cfg.lineupSize &amp;&amp; total&gt;=min &amp;&amp; total&lt;=max){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const key = base.map(p=&gt;p.id).sort().join('|') + (cap?`|C:${cap.id}`:'');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!uniq.has(key)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>uniq.add(key);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>out.push({ id: out.length+1, players: base, captain: cap, totalSalary: total });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let round=0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>while(out.length&lt;N &amp;&amp; round&lt;N*4){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(const cap of caps){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(out.length&gt;=N) break;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>tryBuild(cap);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>round++;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!out.length) throw new Error('No valid lineups; lower Min or raise Max salary.');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return out;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// ---------- events ----------</p>
<p class="p1">const uploadZone = document.getElementById('uploadZone'); const fileInput = document.getElementById('fileInput');</p>
<p class="p1">uploadZone.addEventListener('click',()=&gt;fileInput.click());</p>
<p class="p1">uploadZone.addEventListener('dragover',e=&gt;{e.preventDefault(); uploadZone.classList.add('dragover');});</p>
<p class="p1">uploadZone.addEventListener('dragleave',()=&gt;uploadZone.classList.remove('dragover'));</p>
<p class="p1">uploadZone.addEventListener('drop',e=&gt;{ e.preventDefault(); uploadZone.classList.remove('dragover'); const f=e.dataTransfer.files; if(f.length) processFile(f[0]); });</p>
<p class="p1">fileInput.addEventListener('change',e=&gt;{ if(e.target.files.length) processFile(e.target.files[0]); });</p>
<p class="p2"><br></p>
<p class="p1">async function processFile(file){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const players = await importCSV(file);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.players = players;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.detectedSport = detectSportFromCSV(players);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.datasetMeta = { tournament: file.name.replace(/\.csv$/i,''), eventName: 'Imported CSV' };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>uploadZone.classList.add('has-file');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>showToast(`Loaded ${players.length} players`,`success`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>updateDetection(); setStep(2);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch(err){ showToast(err.message,'error'); }</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">document.getElementById('demoBtn').addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>demoIndex = (demoIndex + 1) % DEMO_ROTATION.length;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const key = DEMO_ROTATION[demoIndex];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const demo = await loadDemoCsv(key);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.players = demo.players;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.detectedSport = demo.sport;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.currentDemoSport = demo.sport;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.contestType = demo.contest;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.datasetMeta = { tournament: demo.tournament, eventName: demo.eventName };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>updateDetection();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>showToast(`Demo loaded: ${DEMO_CSVS[key].label} (${demo.players.length} players)`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setStep(2);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch (err) { showToast(err.message, 'error'); }</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">document.getElementById('backToUpload').addEventListener('click',()=&gt;setStep(1));</p>
<p class="p1">document.getElementById('confirmSport').addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.detectedSport = document.getElementById('sportSelector').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const isDemo = state.players &amp;&amp; state.players.length &amp;&amp; !state.players[0].id?.startsWith('player_'); // rough heuristic</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (isDemo) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const desired = state.contestType;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const key = demoKeyFor(state.detectedSport, desired) || demoKeyFor(state.detectedSport, 'full-slate');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (key) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const demo = await loadDemoCsv(key);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.players = demo.players;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.contestType = demo.contest;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.datasetMeta = { tournament: demo.tournament, eventName: demo.eventName };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateDetection();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setStep(3);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch (err) { showToast(err.message, 'error'); }</p>
<p class="p1">});</p>
<p class="p1">document.getElementById('backToSport').addEventListener('click',()=&gt;setStep(2));</p>
<p class="p2"><br></p>
<p class="p1">const optFull=document.getElementById('optFull'); const optShow=document.getElementById('optShow');</p>
<p class="p1">[optFull,optShow].forEach(el=&gt; el.addEventListener('click',()=&gt;{ [optFull,optShow].forEach(x=&gt;x.classList.remove('selected')); el.classList.add('selected'); state.contestType = el.dataset.type; }));</p>
<p class="p1">document.getElementById('confirmContest').addEventListener('click',()=&gt;{ const cfg=SPORT_CONFIGS[state.detectedSport]; document.getElementById('statSport').textContent = cfg.name; document.getElementById('statContest').textContent = state.contestType==='showdown'? 'Showdown':'Full slate'; document.getElementById('minSalary').value = cfg.salaryRange[0]; document.getElementById('maxSalary').value = cfg.salaryRange[1]; derivePositionOptions(); updateStats(); renderPlayers(); refreshCaptainButtons(); setStep(4); });</p>
<p class="p2"><br></p>
<p class="p1">document.getElementById('generateBtn').addEventListener('click',()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.lineups = generateLineupsMaxSpend();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>renderLineups();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>showToast(`Generated ${state.lineups.length} lineups!`,'success');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch(err){ showToast(err.message,'error'); }</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">document.getElementById('selectAll').addEventListener('click',()=&gt;{ state.players.forEach(p=&gt;p.selected=true); updateStats(); renderPlayers(); });</p>
<p class="p1">document.getElementById('selectNone').addEventListener('click',()=&gt;{ state.players.forEach(p=&gt;{ p.selected=false; p.captain=false; }); updateStats(); renderPlayers(); });</p>
<p class="p1">document.getElementById('selectExpected').addEventListener('click',()=&gt;{ state.players.forEach(p=&gt;{ p.selected = (p.status==='expected'); if(!p.selected) p.captain=false; }); updateStats(); renderPlayers(); });</p>
<p class="p1">document.getElementById('captainAll').addEventListener('click',()=&gt;{ if(!usesCaptains(state.detectedSport, state.contestType)) return; state.players.filter(p=&gt;p.selected).forEach(p=&gt;p.captain=true); updateStats(); renderPlayers(); });</p>
<p class="p1">document.getElementById('clearResults').addEventListener('click',()=&gt;{ state.lineups=[]; renderLineups(); });</p>
<p class="p1">document.getElementById('startOver').addEventListener('click',()=&gt;{ state.players=[]; state.lineups=[]; state.currentDemoSport='nfl'; state.datasetMeta={tournament:'',eventName:''}; document.getElementById('downloadBtn').setAttribute('disabled',''); uploadZone.classList.remove('has-file'); setStep(1); });</p>
<p class="p1">document.getElementById('searchPlayers').addEventListener('input',renderPlayers);</p>
<p class="p1">document.getElementById('positionFilter').addEventListener('change',renderPlayers);</p>
<p class="p2"><br></p>
<p class="p1">window.toggleSelected = id =&gt; { const p=state.players.find(x=&gt;x.id===id); if(!p) return; p.selected=!p.selected; if(!p.selected) p.captain=false; updateStats(); renderPlayers(); };</p>
<p class="p1">window.toggleCaptain = id =&gt; { const p=state.players.find(x=&gt;x.id===id); if(!p) return; if(!usesCaptains(state.detectedSport, state.contestType)) return; p.captain=!p.captain; if(p.captain) p.selected=true; updateStats(); renderPlayers(); };</p>
<p class="p2"><br></p>
<p class="p1">// init</p>
<p class="p1">(function init(){ setStep(1); document.getElementById('ps1').classList.add('active'); document.getElementById('sn1').classList.add('active'); console.log('FanTeam DFS Optimizer â€” MVP v2 ready'); })();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
